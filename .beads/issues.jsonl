{"id":"skillssupply-19a","title":"Implement Hono API: git smart-HTTP + repo generation + auth endpoints","description":"Create packages/api (@skills-supply/api) with Hono server: GET /me/:repo.git/info/refs and POST /me/:repo.git/git-upload-pack, token auth (Basic), repo_state caching, stub plugin generation, CLI auth endpoints (/auth/cli, /auth/cli/status). Use database package for persistence.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T10:14:21.037012-05:00","updated_at":"2025-12-19T13:44:58.058495-05:00","closed_at":"2025-12-19T13:44:58.058495-05:00","close_reason":"Closed via update","dependencies":[{"issue_id":"skillssupply-19a","depends_on_id":"skillssupply-yf2","type":"parent-child","created_at":"2025-12-19T10:14:44.004326-05:00","created_by":"daemon"}]}
{"id":"skillssupply-1ih","title":"Confirm docker-compose defaults (ports/db name/credentials)","description":"Validate desired Postgres docker-compose defaults and adjust docker-compose.yaml + database env expectations.","design":"**Decision: Docker-compose defaults (following cuttlefish convention)**\n\n```yaml\nservices:\n  postgres:\n    image: postgres:18\n    container_name: skillssupply_dev\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: postgres\n      POSTGRES_DB: skillssupply_dev\n    ports:\n      - \"5432:5432\"\n```\n\n**Convention:**\n- Container name: `{project}_dev`\n- User/password: `postgres`/`postgres` (local dev only)\n- DB name: `{project}_dev`\n- Standard port 5432","notes":"Decided 2025-12-19: Follow cuttlefish convention.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:09:08.481756-05:00","updated_at":"2025-12-19T12:57:40.725654-05:00","closed_at":"2025-12-19T12:57:40.725654-05:00","close_reason":"Decision made: Follow cuttlefish convention (skillssupply_dev, postgres/postgres, port 5432)","dependencies":[{"issue_id":"skillssupply-1ih","depends_on_id":"skillssupply-l2q","type":"discovered-from","created_at":"2025-12-19T12:09:13.422882-05:00","created_by":"daemon"}]}
{"id":"skillssupply-453","title":"Confirm stub plugin.json schema and update generator","description":"Decide minimum plugin.json fields for stub plugins and adjust generator accordingly (manifest structure, version, commands).","design":"**Decision: Dynamic stub/full serving from single URL**\n\n**URL:** `skills.supply/u/:CREATOR_USERNAME/:PLUGIN_NAME.git`\n\n**Request flow:**\n1. User fetches via git (Basic auth with API token)\n2. Identify user from credentials, check purchase status\n3. Purchased → full version | Not purchased → stub version\n\n**Stub version (non-purchasers):**\n- Generated on-demand, short TTL cache\n- Valid plugin.json with version `0.0.0-stub`\n- `/buy` command that opens purchase page in browser\n- No freemium content for now (keep simple)\n\n**Full version (purchasers):**\n- Fetched from seller's GitHub on-demand, short TTL cache\n- May inject license validation, analytics, etc.\n\n**Stub plugin.json schema:**\n```json\n{\n  \"name\": \"plugin-name\",\n  \"version\": \"0.0.0-stub\",\n  \"description\": \"Premium plugin by @creator - purchase required\"\n}\n```\n\n**Stub commands/buy.md:**\nOpens `https://skills.supply/u/:creator/:plugin` purchase page","notes":"Decided 2025-12-19: Single URL serves stub vs full based on purchase status. No freemium for now.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:59:53.042926-05:00","updated_at":"2025-12-19T12:41:25.751529-05:00","closed_at":"2025-12-19T12:41:25.751529-05:00","close_reason":"Decision made: dynamic stub/full serving from single URL with /buy command in stub","dependencies":[{"issue_id":"skillssupply-453","depends_on_id":"skillssupply-19a","type":"discovered-from","created_at":"2025-12-19T11:59:58.758514-05:00","created_by":"daemon"}]}
{"id":"skillssupply-642","title":"Review CLI auth handshake flow for security implications","description":"Review the CLI authentication handshake flow for security implications before implementation.\n\nCurrent proposed flow:\n1. CLI calls POST /auth/cli → gets session_id\n2. CLI opens browser to https://skills.supply/auth/cli?session=...\n3. User logs in via browser\n4. CLI polls GET /auth/cli/status?session=... until it gets token\n5. CLI stores token using OS credential helper\n\nQuestions to review:\n- Is session_id sufficiently random/unguessable?\n- Should /auth/cli/status require any auth or is session_id enough?\n- Rate limiting on polling endpoint?\n- Should session be single-use after token issued?\n- Any CSRF/redirect concerns on browser side?","design":"**Decision: Doppler-style Device Flow**\n\n## Flow Summary\n\n1. `POST /auth/cli` → returns `device_code` (secret) + `user_code` (human-readable)\n2. CLI displays code, copies to clipboard, opens browser to `/auth/cli`\n3. User pastes code in browser, clicks Authorize\n4. CLI polls `POST /auth/cli/token` with `device_code`\n5. Server returns token, CLI stores in OS keychain\n\n## User Code Format\n\n- **Length:** 12 characters\n- **Format:** `XXXX-XXXX-XXXX`\n- **Charset:** `BCDFGHJKMNPQRSTVWXYZ` (20 consonants, no vowels, no confusing chars)\n- **Entropy:** 20^12 ≈ 4 trillion combinations\n\n## API Endpoints\n\n**POST /auth/cli** (no auth)\n- Creates session\n- Returns: `{ device_code, user_code, verification_url, expires_in, interval }`\n- Rate limit: 5/min per IP\n\n**GET /auth/cli** (no auth)\n- Browser auth page, user enters code\n\n**POST /auth/cli/verify** (web session required)\n- Body: `{ user_code }`\n- Links user to session, marks authenticated\n\n**POST /auth/cli/token** (no auth)\n- Body: `{ device_code }`\n- Returns: `{ status: \"pending\" | \"success\" | \"expired\", token?, user_id?, username?, email? }`\n- Rate limit: 1/5s per device_code\n\n## Response Statuses\n\n| Status | Meaning |\n|--------|---------|\n| `pending` | User hasn't completed auth yet |\n| `success` | Token issued |\n| `expired` | Session timed out |\n\n## Security Properties\n\n- No session info in URLs\n- `device_code` is 256-bit secret, never exposed\n- `user_code` is human-verified binding\n- Single-use sessions\n- 10 min expiry\n- Rate limited polling\n\n## Database: cli_auth_sessions\n\n```sql\nCREATE TABLE cli_auth_sessions (\n  id UUID PRIMARY KEY,\n  device_code TEXT NOT NULL UNIQUE,  -- 256-bit hex\n  user_code TEXT NOT NULL UNIQUE,    -- XXXX-XXXX-XXXX\n  status TEXT NOT NULL DEFAULT 'pending',\n  user_id UUID REFERENCES users(id),\n  expires_at TIMESTAMPTZ NOT NULL,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  authenticated_at TIMESTAMPTZ,\n  consumed_at TIMESTAMPTZ,\n  ip_address INET,\n  user_agent TEXT\n);\n```","notes":"Decided 2025-12-19: Doppler-style device flow with 12-char user code, no slow_down status.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:53:36.314164-05:00","updated_at":"2025-12-19T13:22:13.931676-05:00","closed_at":"2025-12-19T13:22:13.931676-05:00","close_reason":"Decision made: Doppler-style device flow with user_code (12 chars) + device_code, no URL exposure","dependencies":[{"issue_id":"skillssupply-642","depends_on_id":"skillssupply-qz1","type":"discovered-from","created_at":"2025-12-19T12:53:36.314992-05:00","created_by":"daemon"}]}
{"id":"skillssupply-9uw","title":"Confirm sksup base URL configuration default","description":"Confirm SKSUP_BASE_URL default and override behavior; update CLI config/messages as needed.","design":"**Decision: sksup base URL configuration**\n\n**Default:**\n- `https://api.skills.supply` (production)\n\n**Override:**\n- `SKSUP_BASE_URL` env var\n\n**Implementation:**\n- Use `packages/sksup/src/env.ts` for configuration\n- Bun compiles this into the binary\n- Env var checked at runtime for override\n\n```typescript\n// packages/sksup/src/env.ts\nexport const SKSUP_BASE_URL = process.env.SKSUP_BASE_URL ?? \"https://api.skills.supply\";\n```","notes":"Decided 2025-12-19: Default to api.skills.supply, override via SKSUP_BASE_URL, use env.ts for bun compile.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:09:18.749735-05:00","updated_at":"2025-12-19T12:59:12.993218-05:00","closed_at":"2025-12-19T12:59:12.993218-05:00","close_reason":"Decision made: Default https://api.skills.supply, override via SKSUP_BASE_URL, config in env.ts for bun compile","dependencies":[{"issue_id":"skillssupply-9uw","depends_on_id":"skillssupply-wy2","type":"discovered-from","created_at":"2025-12-19T12:09:22.827054-05:00","created_by":"daemon"}]}
{"id":"skillssupply-l2q","title":"Create packages/database + docker-compose + initial migrations","description":"Copy toastandchill database + related files into packages/database; adapt imports; add docker-compose.yaml at repo root; define initial migrations for users/tokens/cli_auth_sessions/repo_state/plugins/purchases as needed by API + web.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T10:14:15.744229-05:00","updated_at":"2025-12-19T13:44:50.189102-05:00","closed_at":"2025-12-19T13:44:50.189102-05:00","close_reason":"Closed via update","dependencies":[{"issue_id":"skillssupply-l2q","depends_on_id":"skillssupply-yf2","type":"parent-child","created_at":"2025-12-19T10:14:39.963884-05:00","created_by":"daemon"}]}
{"id":"skillssupply-ntq","title":"Track web (Next.js) data-model needs for creator/end-user flows","description":"Define data models for web app: users (id/email/username), creator profiles (payout/Stripe Connect status), plugins (slug/name/description/preview/price/is_active/source repo connection), purchases/entitlements (status/paid_at/refund), API tokens + devices, CLI auth sessions, marketplace listings, and analytics/usage events. Keep in sync with API/db schema decisions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T10:14:30.817009-05:00","updated_at":"2025-12-19T10:39:23.352662-05:00","dependencies":[{"issue_id":"skillssupply-ntq","depends_on_id":"skillssupply-yf2","type":"parent-child","created_at":"2025-12-19T10:14:54.300407-05:00","created_by":"daemon"}]}
{"id":"skillssupply-omg","title":"Confirm API env var conventions (PUBLIC_BASE_URL, WEB_BASE_URL, REPO_CACHE_DIR, TTL)","description":"Decide naming/values for API env vars and defaults; update packages/api/src/env.ts and docs accordingly.","design":"**Decision: API env var conventions**\n\n**Base URLs:**\n- `API_BASE_URL` — public-facing API URL (e.g., `https://api.skills.supply`)\n- `WEB_BASE_URL` — web app URL for redirects (e.g., `https://skills.supply`)\n\n**Repo caching:**\n- `REPO_CACHE_DIR` — directory for cloned repos\n- `REPO_CACHE_TTL` — how long cached repos stay valid\n\n**Auth TTLs:**\n- `CLI_AUTH_SESSION_TTL` — browser auth session expiry (10 min)\n- `API_TOKEN_TTL` — token expiry duration (6-8 weeks)\n\n**Naming convention:**\n- Group related vars with shared prefix: `REPO_CACHE_*`, `CLI_AUTH_*`, `API_*`\n- TTLs are always `{GROUP}_{THING}_TTL` or `{THING}_TTL`\n- Makes it obvious what belongs together","notes":"Decided 2025-12-19: Use grouped prefixes (REPO_CACHE_*, CLI_AUTH_*, etc.) for clarity.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:08:58.389036-05:00","updated_at":"2025-12-19T12:56:13.051727-05:00","closed_at":"2025-12-19T12:56:13.051727-05:00","close_reason":"Decision made: API_BASE_URL, WEB_BASE_URL, grouped prefixes for TTLs (REPO_CACHE_TTL, CLI_AUTH_SESSION_TTL, etc.)","dependencies":[{"issue_id":"skillssupply-omg","depends_on_id":"skillssupply-19a","type":"discovered-from","created_at":"2025-12-19T12:09:03.238443-05:00","created_by":"daemon"}]}
{"id":"skillssupply-otj","title":"Define purchased plugin source integration (repo_url/source_repo_path)","description":"Decide how purchased plugin content is sourced and served (local mirror path vs remote clone, credentials for private GitHub, update strategy). Update plugin schema + API repo resolver accordingly.","design":"**Decision: Clone-on-demand from seller's repo**\n\n- When buyer requests a purchased plugin, we clone from seller's source repo on-demand\n- Serve from local clone, no long-term caching for now (add later if needed)\n- Seller provides access via GitHub OAuth token or deploy key\n- Buyer authenticates with Skills Supply API token only - no GitHub OAuth needed for buyers\n\n**Data model:**\n- `plugins.source_repo_url` - seller's GitHub repo\n- `plugins.source_ref` - branch/tag to clone\n- Clone stored temporarily in `REPO_CACHE_DIR`","notes":"Decided 2025-12-19: Keep simple with on-demand cloning. Add caching layer later when needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:59:39.885501-05:00","updated_at":"2025-12-19T12:41:31.950446-05:00","closed_at":"2025-12-19T12:41:31.950446-05:00","close_reason":"Decision made: clone-on-demand from seller's GitHub, short TTL cache, no buyer OAuth needed","dependencies":[{"issue_id":"skillssupply-otj","depends_on_id":"skillssupply-19a","type":"discovered-from","created_at":"2025-12-19T11:59:47.836228-05:00","created_by":"daemon"}]}
{"id":"skillssupply-qz1","title":"Decide CLI auth completion handshake + token format","description":"Confirm /auth/cli completion mechanism (endpoint + auth), session TTL, and API token format/prefix. Align API + sksup behavior accordingly.","design":"**Partial decision: Session TTL + Token expiry**\n\n**Browser auth session TTL:**\n- Session expires after 10 minutes if not completed\n- Forces user to run `sksup auth` again if they wait too long\n\n**Token expiry:**\n- See skillssupply-zfe for token format and expiry details\n\n**CLI auth handshake:**\n- Carved out to separate issue (skillssupply-xxx) for security review\n- Initial thinking: POST /auth/cli → session_id, poll /auth/cli/status\n- Needs security review before finalizing","notes":"Decided 2025-12-19: 10 min session TTL. CLI auth handshake carved out for separate security review.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:00:05.05884-05:00","updated_at":"2025-12-19T12:53:44.271866-05:00","closed_at":"2025-12-19T12:53:44.271866-05:00","close_reason":"Session TTL decided (10 min). CLI auth handshake carved out to skillssupply-642 for security review.","dependencies":[{"issue_id":"skillssupply-qz1","depends_on_id":"skillssupply-19a","type":"discovered-from","created_at":"2025-12-19T12:00:12.06897-05:00","created_by":"daemon"}]}
{"id":"skillssupply-wy2","title":"Implement sksup CLI commands + credential helper flow","description":"Create packages/sksup (@skills-supply/sksup) CLI with auth/status/logout/whoami; browser auth, polling, git credential helper config and storage; no distribution scripts yet.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T10:14:25.895604-05:00","updated_at":"2025-12-19T13:45:04.322472-05:00","closed_at":"2025-12-19T13:45:04.322472-05:00","close_reason":"Closed via update","dependencies":[{"issue_id":"skillssupply-wy2","depends_on_id":"skillssupply-yf2","type":"parent-child","created_at":"2025-12-19T10:14:49.686985-05:00","created_by":"daemon"}]}
{"id":"skillssupply-yf2","title":"Implement Hono git server + sksup CLI packages (v3 design)","description":"Build API package for git HTTP smart protocol + auth endpoints and CLI package for auth/credential setup/install flow. Track ExecPlan + web data-model needs.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-19T10:06:33.574595-05:00","updated_at":"2025-12-19T13:45:09.167641-05:00","closed_at":"2025-12-19T13:45:09.167641-05:00","close_reason":"Closed via update"}
{"id":"skillssupply-zfe","title":"Decide API token format + Basic username validation behavior","description":"Confirm token format/prefixing (e.g., ss_live_) and whether Basic auth should require username match. Update API auth + CLI handling accordingly.","design":"**Decision: Token format + Basic auth validation**\n\n**Token format:**\n- `ss_prod_xxx` for production\n- `ss_stg_xxx` for staging\n- Environment prefix makes it clear which environment a token belongs to\n\n**Basic auth validation:**\n- Username = user_id\n- Password = token\n- Backend MUST validate BOTH match (not just token)\n- Prevents token reuse if leaked without user_id\n\n**Token expiry:**\n- Tokens expire after 6-8 weeks (exact duration stored in code as constant)\n- `tokens.created_at` stored in database\n- Allows dynamic expiry adjustment without migration\n- On auth, check: `now - created_at \u003c TOKEN_TTL`","notes":"Decided 2025-12-19: ss_prod_/ss_stg_ prefix, validate both username+token, 6-8 week expiry with created_at in DB.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T12:08:50.335515-05:00","updated_at":"2025-12-19T12:53:44.223449-05:00","closed_at":"2025-12-19T12:53:44.223449-05:00","close_reason":"Decision made: ss_prod_/ss_stg_ prefix, validate both username+token, 6-8 week expiry","dependencies":[{"issue_id":"skillssupply-zfe","depends_on_id":"skillssupply-19a","type":"discovered-from","created_at":"2025-12-19T12:08:54.083279-05:00","created_by":"daemon"}]}
